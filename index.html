<!DOCTYPE html>
<html>
<head>
  <title>Temp Mail Box</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      background: #f5f5f5;
    }
    .email {
      font-size: 22px;
      font-weight: bold;
      color: green;
    }
    #inbox {
      margin-top: 30px;
    }
    .message {
      background: #fff;
      padding: 15px;
      margin: 10px auto;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      max-width: 600px;
      text-align: left;
    }
    .message pre {
      background: #eee;
      padding: 10px;
      overflow-x: auto;
    }
    button {
      margin-top: 10px;
      padding: 8px 12px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ðŸ“¨ Your Temp Mail</h1>
  <p>Your email address:</p>
  <p class="email">Loading...</p>
  <button onclick="copyEmail()">Copy Email</button>

  <h2>Inbox</h2>
  <div id="inbox">Checking inbox...</div>

  <script>
    let token = "", address = "", password = "";

    async function checkInbox() {
      const res = await fetch("https://api.mail.tm/messages", {
        headers: { Authorization: `Bearer ${token}` },
      });
      const data = await res.json();
      const inbox = document.getElementById("inbox");
      inbox.innerHTML = "";

      if (!data["hydra:member"].length) {
        inbox.innerHTML = "ðŸ“­ No messages yet.";
        return;
      }

      for (let msg of data["hydra:member"]) {
        const res2 = await fetch(`https://api.mail.tm/messages/${msg.id}`, {
          headers: { Authorization: `Bearer ${token}` },
        });
        const full = await res2.json();
        inbox.innerHTML += `
          <div class="message">
            <b>From:</b> ${msg.from.address}<br>
            <b>Subject:</b> ${msg.subject}<br>
            <pre>${full.text || "No text content"}</pre>
          </div>
        `;
      }
    }

    async function loadOrCreateAccount() {
      if (
        localStorage.getItem("email") &&
        localStorage.getItem("token") &&
        localStorage.getItem("password")
      ) {
        address = localStorage.getItem("email");
        token = localStorage.getItem("token");
        password = localStorage.getItem("password");
        document.querySelector(".email").textContent = address;
        checkInbox();
        return;
      }

      let rand = Math.random().toString(36).substring(2, 10);
      address = `${rand}@mail.tm`;
      password = rand + rand;

      await fetch("https://api.mail.tm/accounts", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ address, password }),
      });

      const res = await fetch("https://api.mail.tm/token", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ address, password }),
      });
      const data = await res.json();

      token = data.token;
      localStorage.setItem("email", address);
      localStorage.setItem("password", password);
      localStorage.setItem("token", token);
      document.querySelector(".email").textContent = address;
      checkInbox();
    }

    function copyEmail() {
      navigator.clipboard.writeText(address).then(() => {
        alert("ðŸ“‹ Email copied: " + address);
      });
    }

    loadOrCreateAccount();
    setInterval(checkInbox, 15000); // refresh inbox every 15 sec
  </script>
</body>
</html>

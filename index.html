<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8" /><title>Temp Mail Inbox Debug</title></head>
<body>
  <h1>Temp Mail Inbox</h1>
  <div id="email"></div>
  <button onclick="refreshInbox()">Refresh Inbox</button>
  <div id="inbox"></div>

  <script>
    const username = Math.random().toString(36).substring(2, 10);
    const domain = "1secmail.com";
    const email = `${username}@${domain}`;
    document.getElementById("email").textContent = `Email: ${email}`;

    async function refreshInbox() {
      const inboxDiv = document.getElementById("inbox");
      inboxDiv.textContent = "Loading...";
      try {
        const res = await fetch(`https://www.1secmail.com/api/v1/?action=getMessages&login=${username}&domain=${domain}`);
        if(!res.ok) throw new Error(`HTTP error! status: ${res.status}`);

        const messages = await res.json();

        if(!messages.length) {
          inboxDiv.textContent = "No messages yet.";
          return;
        }

        inboxDiv.innerHTML = "";
        for(const msg of messages) {
          const res2 = await fetch(`https://www.1secmail.com/api/v1/?action=readMessage&login=${username}&domain=${domain}&id=${msg.id}`);
          const fullMsg = await res2.json();

          inboxDiv.innerHTML += `<div>
            <b>From:</b> ${fullMsg.from} <br/>
            <b>Subject:</b> ${fullMsg.subject} <br/>
            <pre>${fullMsg.textBody || fullMsg.htmlBody || "No content"}</pre>
            <hr/>
          </div>`;
        }
      } catch(e) {
        inboxDiv.textContent = `Error loading inbox: ${e.message}`;
        console.error(e);
      }
    }

    refreshInbox();
  </script>
</body>
</html>
